/*!
 * ng-cordova-settings
 * Copyright 2015 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){angular.module("ng-cordova-settings",["ngCordova.plugins.file"]).factory("settings",["$q","$window","$cordovaFile",function(e,r,n){"use strict";function t(){return!r.cordova&&!r.PhoneGap&&!r.phonegap}function i(e){return null===e||"boolean"==typeof e||angular.isNumber(e)||angular.isString(e)||angular.isArray(e)||angular.isObject(e)}function o(e,r,n){for(var t=0,i=r.length;t<i;++t){var a=r[t];if(angular.isObject(a)||angular.isFunction(a))for(var u=Object.keys(a),c=0,l=u.length;c<l;c++){var s=u[c],f=a[s];n&&angular.isObject(f)?(angular.isObject(e[s])||(e[s]=angular.isArray(f)?[]:{}),o(e[s],[f],!0)):angular.isDefined(f)?e[s]=f:delete e[s]}}return e}function a(e){return o(e,[].slice.call(arguments,1),!0)}function u(r){var n=e.defer();if(angular.isUndefined(r))v().then(n.resolve,n.reject);else if(angular.isString(r))v().then(function(e){n.resolve(e[r])},n.reject);else{if(!angular.isArray(r))throw new TypeError("Invalid input parameter");v().then(function(e){for(var t={},i=0,o=r.length;i<o;i++)t[r[i]]=e[r[i]];n.resolve(t)},n.reject)}return n.promise}function c(r,n){var t=e.defer(),o={};if(angular.isString(r)&&angular.isUndefined(n))o[r]=void 0;else if(angular.isString(r)&&i(n))o[r]=n;else{if(!angular.isObject(r)||!angular.isUndefined(n))throw new TypeError("Invalid input parameters");o=r}return v().then(function(e){g(e,o).then(t.resolve,t.reject)},function(){g({},o).then(t.resolve,t.reject)}),t.promise}function l(){var r=e.defer();return v().then(function(e){r.resolve(Object.keys(e))},r.reject),r.promise}function s(){var r=e.defer();return h("{}").then(r.resolve,r.reject),r.promise}function f(){var r=e.defer();return p().then(r.resolve,r.reject),r.promise}function v(){var r=e.defer();return d().then(function(e){if(!e)return r.reject("Empty");var n;try{n=JSON.parse(e)}catch(t){throw new ReferenceError("Damaged settings data")}r.resolve(n)},r.reject),r.promise}function g(r,n){var t=e.defer(),i=a({},r,n);return h(JSON.stringify(i)).then(t.resolve,t.reject),t.promise}function d(){var i=e.defer();return t()?i.resolve(r.localStorage[j]):n.readAsText(cordova.file.dataDirectory,j).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}function h(i){var o=e.defer();return t()?(r.localStorage[j]=i,o.resolve()):n.writeFile(cordova.file.dataDirectory,j,i,!0).then(function(){o.resolve()},function(e){o.reject(e)}),o.promise}function p(){var i=e.defer();return t()?(r.localStorage.removeItem(j),i.resolve()):n.removeFile(cordova.file.dataDirectory,j).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}function m(e){return!!(angular.isString(e)&&e.length>0)&&(j=e,!0)}var j="settings.txt";return{read:u,write:c,keys:l,empty:s,remove:f,setStorageFilename:m}}])}();